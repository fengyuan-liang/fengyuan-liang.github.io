# Tcp三次握手四次挥手

## 1. 三次握手

![image-20220530170933189](https://cdn.fengxianhub.top/resources-master/202205301709471.png)

1. 首先客户端向服务端发送`SYN`包，请求建立连接
2. 服务端接收到`SYN`包后会回复`SYN-ACK`包，表示收到SYN包并且可以建立连接
3. 客户端接收到`SYN-ACK`包后，回复`ACK`包确认，至此连接建立

为什么不是两次握手呢？主要防止服务端发送`SYN-ACK`包时出现堵塞的情况，如果堵塞了，客户端没有接收到会重发`SYN`包建立连接，如果此时堵塞的`SYN-ACK`包会发到客户端就会导致连接状态不一致的情况（客户端以为只有一个连接，服务端却认为有两个）

## 2. 四次挥手

![image-20220530171617455](https://cdn.fengxianhub.top/resources-master/202205301716682.png)

1. 首先客户端向服务端发送`FIN`包表示需要关闭连接
2. 服务端收到后回复`ACK`表示确认，此时服务端还可以继续向客户端发送为传输完的数据，待传输完成后，回复`FIN`包表示关闭连接
3. 客户端收到后回复`ACK`包表示确认，此时进入超时等待时间
4. 服务端接收到`ACK`包后会立即关闭连接

为什么在第四次挥手中客户端需要再等待一段时间呢？而不是向服务端一样直接关闭连接，这是为了防止客户端的最后一包`ACK`包丢失的情况，如果丢失后客户端立刻关闭，那么服务端会一直处于等待的状态，但是如果客户端等待一段时间，服务端没有收到`ACK`包而重发了`FIN`包，客户端就能够接收到，重发`ACK`包并刷新超时时间

这都是为了在不可靠的网络链路中进行可靠的传输、可靠的连接确认















